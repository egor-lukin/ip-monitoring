version: '7.1'

environment:
  ENV: development

compose:
  files:
    - .dockerdev/compose.yml
  project_name: ip_monitoring

interaction:
  web:
    service: web
    compose:
      run_options: [ service-ports, use-aliases ]

  bash:
    service: web
    command: /bin/bash
    compose_run_options: [ no-deps ]

  rspec:
    service: web
    command: bundle exec rspec

  bundle:
    description: Run Bundler commands
    service: web
    command: bundle
    compose_run_options: [ no-deps ]

  sidekiq:
    description: Run Rails commands
    service: sidekiq

  psql:
    description: Run Postgres psql console
    service: postgres
    default_args: ip_monitoring_dev
    command: psql -h postgres -U postgres

provision:
  - dip compose down --volumes || true
  - dip compose up -d postgres
